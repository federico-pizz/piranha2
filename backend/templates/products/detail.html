{% extends "base.html" %}

{% block title %}{{ product.title }} - Piranha ITA{% endblock %}

{% block content %}
<section class="product-detail">
    <div class="container">
        <!-- Breadcrumb -->
        <nav class="breadcrumb">
            <a href="/">Home</a>
            <span>‚Ä∫</span>
            <a href="/products">Prodotti</a>
            <span>‚Ä∫</span>
            <a href="/products?category={{ product.category }}">{{ product.category|capitalize }}</a>
            <span>‚Ä∫</span>
            <span>{{ product.title[:30] }}...</span>
        </nav>

        <div class="product-layout">
            <!-- Main Content -->
            <div class="product-main">
                <div class="product-image-container">
                    <div class="product-image-placeholder">
                        <span class="placeholder-icon">üì¶</span>
                    </div>
                    <span class="condition-badge condition-{{ product.condition }}">{{ product.condition }}</span>
                </div>

                <div class="product-info">
                    <h1>{{ product.title }}</h1>

                    <div class="product-price-row">
                        <span class="product-price">‚Ç¨{{ "%.2f"|format(product.price_eur) }}</span>
                        <span class="product-source">da {{ product.source_name }}</span>
                    </div>

                    <div class="product-meta">
                        <div class="meta-item">
                            <span class="meta-label">üìç Localit√†</span>
                            <span class="meta-value">{{ product.city or 'N/A' }}, {{ product.region or 'Italia'
                                }}</span>
                        </div>
                        {% if product.brand %}
                        <div class="meta-item">
                            <span class="meta-label">üè∑Ô∏è Marca</span>
                            <span class="meta-value">{{ product.brand }}</span>
                        </div>
                        {% endif %}
                        {% if product.year %}
                        <div class="meta-item">
                            <span class="meta-label">üìÖ Anno</span>
                            <span class="meta-value">{{ product.year }}</span>
                        </div>
                        {% endif %}
                        <div class="meta-item">
                            <span class="meta-label">üìÇ Categoria</span>
                            <span class="meta-value">{{ product.category|capitalize }}</span>
                        </div>
                    </div>

                    <div class="product-description">
                        <h3>Descrizione</h3>
                        <p>{{ product.description or 'Nessuna descrizione disponibile.' }}</p>
                    </div>

                    <div class="product-actions">
                        <a href="{{ product.source_url }}" target="_blank" rel="noopener"
                            class="btn btn-primary btn-lg">
                            Vai all'annuncio ‚Üí
                        </a>
                        {% if user %}
                        <button hx-post="/recommendations/feedback"
                            hx-vals='{"product_id": "{{ product.id }}", "type": "like"}' hx-swap="outerHTML"
                            class="btn btn-outline">
                            ‚ù§Ô∏è Salva
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <aside class="product-sidebar">
                <div class="sidebar-card">
                    <h4>‚ö†Ô∏è Consigli di Sicurezza</h4>
                    <ul>
                        <li>Incontrati sempre in luoghi pubblici</li>
                        <li>Non pagare in anticipo</li>
                        <li>Controlla bene il prodotto prima</li>
                        <li>Diffida di prezzi troppo bassi</li>
                    </ul>
                </div>

                <div class="sidebar-card">
                    <h4>üìä Info Prezzo</h4>
                    <p class="price-note">Prezzo rilevato il {{ product.scraped_at.strftime('%d/%m/%Y') if
                        product.scraped_at else 'N/A' }}</p>
                </div>
            </aside>
        </div>

        <!-- Back Link -->
        <div class="back-link">
            <a href="/products" class="btn btn-outline">‚Üê Torna ai prodotti</a>
        </div>
    </div>
</section>

<style>
    .product-detail {
        padding: 2rem 0;
    }

    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 1rem;
    }

    /* Breadcrumb */
    .breadcrumb {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 2rem;
        font-size: 0.875rem;
        color: var(--color-text-muted);
    }

    .breadcrumb a {
        color: var(--color-primary);
        text-decoration: none;
    }

    .breadcrumb a:hover {
        text-decoration: underline;
    }

    /* Layout */
    .product-layout {
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 2rem;
    }

    /* Main */
    .product-main {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
    }

    .product-image-container {
        position: relative;
        background: var(--color-surface);
        border-radius: var(--radius-lg);
        padding: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 300px;
    }

    .product-image-placeholder {
        display: flex;
        flex-direction: column;
        align-items: center;
        color: var(--color-text-muted);
    }

    .placeholder-icon {
        font-size: 4rem;
    }

    .condition-badge {
        position: absolute;
        top: 1rem;
        right: 1rem;
        padding: 0.25rem 0.75rem;
        border-radius: var(--radius-sm);
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
    }

    .condition-nuovo {
        background: #10b981;
        color: white;
    }

    .condition-buono {
        background: #3b82f6;
        color: white;
    }

    .condition-discreto {
        background: #f59e0b;
        color: white;
    }

    .condition-usato {
        background: #6b7280;
        color: white;
    }

    /* Info */
    .product-info h1 {
        font-size: 1.5rem;
        margin-bottom: 1rem;
    }

    .product-price-row {
        display: flex;
        align-items: baseline;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .product-price {
        font-size: 2rem;
        font-weight: 700;
        color: var(--color-primary);
    }

    .product-source {
        font-size: 0.875rem;
        color: var(--color-text-muted);
    }

    .product-meta {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .meta-item {
        display: flex;
        flex-direction: column;
    }

    .meta-label {
        font-size: 0.75rem;
        color: var(--color-text-muted);
    }

    .meta-value {
        font-weight: 500;
    }

    .product-description {
        margin-bottom: 1.5rem;
    }

    .product-description h3 {
        font-size: 1rem;
        margin-bottom: 0.5rem;
    }

    .product-description p {
        color: var(--color-text-muted);
        line-height: 1.6;
    }

    .product-actions {
        display: flex;
        gap: 1rem;
    }

    .btn-lg {
        padding: 1rem 2rem;
    }

    /* Sidebar */
    .product-sidebar {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .sidebar-card {
        background: var(--color-surface);
        border-radius: var(--radius-lg);
        padding: 1.5rem;
    }

    .sidebar-card h4 {
        margin-bottom: 1rem;
    }

    .sidebar-card ul {
        list-style: none;
        padding: 0;
    }

    .sidebar-card li {
        padding: 0.5rem 0;
        border-bottom: 1px solid var(--color-border);
        font-size: 0.875rem;
    }

    .sidebar-card li:last-child {
        border-bottom: none;
    }

    .price-note {
        font-size: 0.875rem;
        color: var(--color-text-muted);
    }

    .back-link {
        margin-top: 2rem;
    }

    @media (max-width: 900px) {
        .product-layout {
            grid-template-columns: 1fr;
        }

        .product-main {
            grid-template-columns: 1fr;
        }

        .product-sidebar {
            order: -1;
        }
    }
</style>
{% endblock %}